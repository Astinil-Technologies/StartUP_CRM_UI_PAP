<div class="received-wrapper">
  <div class="received-card">

    <!-- Sticky header -->
    <div class="card-header">
      <h2 class="received-header">
        <img src="https://cdn-icons-png.flaticon.com/128/942/942748.png" width="24" />
        Received Files
      </h2>
    </div>

    <!-- Scrollable content -->
    <div class="scrollable-content">
      <div *ngIf="loading" class="loading-msg">Loading files…</div>
      <div *ngIf="error" class="error-msg">{{ error }}</div>

      <!-- Table -->
      <table class="file-table" *ngIf="!loading && files.length">
        <thead>
          <tr>
            <th>Sr. No</th>
            <th>Filename</th>
            <th>Type</th>
            <th>Size</th>
            <th>Shared By</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let file of files; let i = index">
            <td>{{ getSerialNumber(i) }}</td>
            <td>{{ file.name }}</td>
            <td>{{ file.type }}</td>
            <td>{{ formatSize(file.size) }}</td>
            <td>{{ file.sharedByName }}</td>
            <td>{{ file.uploadedAt | date: 'short' }}</td>
            <td>
              <div class="action-buttons">
                <button class="preview-btn" (click)="previewFile(file.id)">
                  <span>Preview</span>
                </button>
                <button class="download-btn" (click)="downloadFile(file.id, file.name)">
                  <span>Download</span>
                </button>
                <button class="share-btn" (click)="shareFile(file.id)">
                  <span>Share</span>
                </button>
                <button class="delete-btn" (click)="deleteFile(file.id)">
                  <span>Delete</span>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Pagination -->
      <div class="pagination" *ngIf="totalPages > 1">
        <button [disabled]="currentPage === 0" (click)="changePage(currentPage - 1)">Prev</button>
        <span>Page {{ currentPage + 1 }} of {{ totalPages }}</span>
        <button [disabled]="currentPage >= totalPages - 1" (click)="changePage(currentPage + 1)">Next</button>
      </div>
    </div>
  </div>
</div>

<!-- Single Preview Modal (image or PDF) -->
<div class="preview-modal" *ngIf="previewUrl" (click)="closePreview()">
  <div class="preview-content" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closePreview()">✖</button>

    <ng-container *ngIf="isPdf; else imageTpl">
      <iframe [src]="previewUrl" width="100%" height="600" style="border: none;"></iframe>
    </ng-container>

    <ng-template #imageTpl>
      <img [src]="previewUrl" alt="Preview Image" style="max-width: 100%; height: auto;" />
    </ng-template>
  </div>
</div>